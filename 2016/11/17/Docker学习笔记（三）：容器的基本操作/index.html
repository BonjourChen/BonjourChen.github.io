<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Docker学习笔记（三）：容器的基本操作 · Bonjour!</title><meta name="description" content="Docker学习笔记（三）：容器的基本操作 - BonjourChen"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="Bonjour!"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Docker学习笔记（三）：容器的基本操作</h1><div class="post-info">Nov 17, 2016</div><div class="post-content"><h4 id="创建容器"><a href="#创建容器" class="headerlink" title="创建容器"></a>创建容器</h4><p>可以使用docker create新建一个容器。<br>语法：<code>docker create [OPTIONS] IMAGE [COMMAND] [ARG...]</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[wb@localhost ~]$ sudo docker create -it ubuntu:latest</div><div class="line">f7b133bf8400a30f8284d1b542571a7478fcd409dd5d987d80c85cb84e1f6b2a</div><div class="line">[wb@localhost ~]$ sudo docker ps -a</div><div class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                     PORTS               NAMES</div><div class="line">f7b133bf8400        ubuntu:latest       &quot;/bin/bash&quot;         5 seconds ago       Created                                        backstabbing_cray</div></pre></td></tr></table></figure></p>
<p><code>sudo docker ps -a</code>查看所有容器。如果不加上<code>-a</code>参数，则只看正在运行中的容器。<br>这里看到container自动生成了一个名字。如果要自己命名的话，可以加上–name参数:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[wb@localhost ~]$ sudo docker create --name &quot;abc&quot; ubuntu:14.04</div></pre></td></tr></table></figure></p>
<a id="more"></a>
<h4 id="运行容器"><a href="#运行容器" class="headerlink" title="运行容器"></a>运行容器</h4><p>使用docker create创建的容器是处于停止状态，可以使用<code>docker start</code>命令启动。<br>使用<code>docker run</code>可以新建并启动容器。等价于先执行docker create，再执行docker start。<br>当使用docker run来创建并启动容器时，Docker在后台运行的操作包括：</p>
<ol>
<li>检查本地是否存在指定镜像，不存在则从仓库下载。</li>
<li>利用镜像创建一个容器。</li>
<li>分配一个文件系统，并在只读的镜像层外面挂载一层可读可写层。</li>
<li>从宿主主机配置的网桥接口中桥接一个虚拟接口到容器中去。</li>
<li>从地址池分配一个IP地址给容器。</li>
<li>执行用户指定的应用程序。</li>
<li>执行完毕后容器被终止。</li>
</ol>
<p>例如：创建一个容器，并启动一个bash终端：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[wb@localhost ~]$ sudo docker run -t -i ubuntu:latest /bin/bash</div><div class="line">root@c1e24dd0dc90:/# ps</div><div class="line">   PID TTY          TIME CMD</div><div class="line">     1 ?        00:00:00 bash</div><div class="line">    10 ?        00:00:00 ps</div></pre></td></tr></table></figure></p>
<p>可以看到已经进入了容器内，然后只运行了bash进程。<code>-t</code>选项让Docker分配一个伪终端绑定到容器的标准输入上，<code>-i</code>让容器的标准输入保持打开。<br>可以使用<code>Ctrl+D</code>或者<code>exit</code>退出容器。退出容器之后容器处于终止状态。</p>
<h4 id="使用守护态运行容器"><a href="#使用守护态运行容器" class="headerlink" title="使用守护态运行容器"></a>使用守护态运行容器</h4><p>可以通过<code>-d</code>参数在后台运行程序。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[wb@localhost ~]$ sudo docker run -d ubuntu /bin/sh -c &quot;while true;do echo hello world; sleep 1; done&quot;</div><div class="line">e776b87c92e1d26e782f0ead2dc4f401780c84eebb9419486480f0ef50584320</div><div class="line">[wb@localhost ~]$ sudo docker ps -a</div><div class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</div><div class="line">e776b87c92e1        ubuntu              &quot;/bin/sh -c &apos;while tr&quot;   8 seconds ago       Up 7 seconds                            nostalgic_varahamihira</div></pre></td></tr></table></figure></p>
<p>可看到容器运行的状态为Up<br>查看log输出信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[wb@localhost ~]$ sudo docker logs e776</div><div class="line">hello world</div><div class="line">hello world</div><div class="line">……</div></pre></td></tr></table></figure></p>
<h4 id="终止容器"><a href="#终止容器" class="headerlink" title="终止容器"></a>终止容器</h4><p>使用<code>docker stop</code>来终止一个运行中的容器。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[wb@localhost ~]$ sudo docker stop e776</div><div class="line">e776</div><div class="line">[wb@localhost ~]$ sudo docker ps -a</div><div class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                       PORTS               NAMES</div><div class="line">e776b87c92e1        ubuntu              &quot;/bin/sh -c &apos;while tr&quot;   3 minutes ago       Exited (137) 7 seconds ago                       nostalgic_varahamihira</div></pre></td></tr></table></figure></p>
<p>可以看到容器的运行状态变成了Exited。</p>
<h4 id="重启容器"><a href="#重启容器" class="headerlink" title="重启容器"></a>重启容器</h4><p>使用<code>docker restart</code>重启容器。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[wb@localhost ~]$ sudo docker restart e776</div><div class="line">e776</div><div class="line">[wb@localhost ~]$ sudo docker ps -a</div><div class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</div><div class="line">e776b87c92e1        ubuntu              &quot;/bin/sh -c &apos;while tr&quot;   4 minutes ago       Up 2 seconds                            nostalgic_varahamihira</div></pre></td></tr></table></figure></p>
<h4 id="进入容器"><a href="#进入容器" class="headerlink" title="进入容器"></a>进入容器</h4><p>使用<code>-d</code>参数会使容器在后台运行，这时候如果想进入容器的话，可以使用<code>docker attach</code>或者<code>docker exec</code>命令。在进入容器前应当确保容器正在运行。无法进入已经停止了的容器。<br>使用docker attach命令示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[wb@localhost ~]$ sudo docker attach e776</div><div class="line">You cannot attach to a stopped container, start it first</div><div class="line">[wb@localhost ~]$ sudo docker start e776</div><div class="line">e776</div><div class="line">[wb@localhost ~]$ sudo docker attach e776</div><div class="line">hello world</div><div class="line">hello world</div></pre></td></tr></table></figure></p>
<p>但是使用attach命令有时并不方便。当多个窗口同时attach到同一个容器时，所有窗口会同时显示。<br>使用docker exec进入刚才的容器：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[wb@localhost ~]$ sudo docker  exec -ti e776 /bin/bash</div><div class="line">root@e776b87c92e1:/#</div></pre></td></tr></table></figure></p>
<h4 id="删除容器"><a href="#删除容器" class="headerlink" title="删除容器"></a>删除容器</h4><p>可以使用<code>docker rm</code>命令删除处于终止状态的容器。主要参数包括：</p>
<ul>
<li>-f –force=false，强行删除一个正在运行中的容器</li>
<li>-l –link=false删除容器的连接，但保留容器</li>
<li>-v –volumes=false删除容器挂载的数据卷</li>
</ul>
<h4 id="导出容器"><a href="#导出容器" class="headerlink" title="导出容器"></a>导出容器</h4><p>使用<code>docker export</code>命令可以将容器导出成文件，不管这个容器是否处于运行状态。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[wb@localhost ~]$ sudo docker export e776 &gt; e776.tar</div><div class="line">[wb@localhost ~]$ ls</div><div class="line">e776.tar</div></pre></td></tr></table></figure></p>
<h4 id="导入容器"><a href="#导入容器" class="headerlink" title="导入容器"></a>导入容器</h4><p>可以使用<code>docker import</code>命令导入，成为镜像。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[wb@localhost ~]$ cat e776_run.tar | sudo docker import - test:new</div><div class="line">sha256:b437bdece274335a0e532e54b7a53d161809a14d13f343762bf4acc91fd88675</div><div class="line">[wb@localhost ~]$ sudo docker images                              </div><div class="line">REPOSITORY           TAG                 IMAGE ID            CREATED             SIZE</div><div class="line">test                 new                 b437bdece274        19 seconds ago      110.4 MB</div><div class="line">test                 latest              1dc93be3cc77        54 seconds ago      110.4 MB</div><div class="line">ubuntu               12.04               574af84d86e9        23 hours ago        145.8 MB</div><div class="line">&lt;none&gt;               &lt;none&gt;              9790710e4c85        24 hours ago        187.9 MB</div></pre></td></tr></table></figure></p>
<p>要注意的是，导入容器实际上是生成了一个新的镜像，所以导入的镜像最好加上与现在的镜像不重复的tag。之前导入的时候并没有加上new的tag，所以默认是保存为latest的镜像。那之前的test：latest镜像就会显示成为<code>&lt;none&gt;:&lt;none&gt;</code>。如果要修改镜像名称的话，可以使用<code>docker tag imageid name:tag</code>解决。<br>注：用户既可以使用 docker load 来导入镜像存储文件到本地镜像库，也可以使用 docker import 来导入一个容器快照到本地镜像库。这两者的区别在于容器快照文件将丢弃所有的历史记录和元数据信息（即仅保存容器当时的快照状态），而镜像存储文件将保存完整记录，体积也要大。此外，从容器快照文件导入时可以重新指定标签等元数据信息。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2016/11/16/Docker学习笔记（二）：镜像的基本操作/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2017 <a href="http://yoursite.com">BonjourChen</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>